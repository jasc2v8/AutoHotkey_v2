
Use Cases:

	1. Script.ahk or Script.exe
	2. Shortcut.lnk

	Case 1. Script.ahk or Script.exe

		Options:
			1. RunAhk /Run with arguments (no reply. RunWait without the Task is not supported.)
			2. Start Task RunAhk then send Run(Command) or RunWait(Command) via NamedPipe IPC
			3. (Rarely used) Start Task then RunLib.Run(RunAhk /RunWait) with arguments. Receive reply via NamedPipe IPC.
		
		Option 1: Run or RunWait with arguments
		
			A_AhkPath RunAdmin.ahk /Run PROGRAM PARAM1 PARAMn
							  RunAdmin.exe /Run PROGRAM PARAM1 PARAMn
			-or-
			
			ipc.StartTask()
			A_AhkPath RunAdmin.ahk /RunWait PROGRAM PARAM1 PARAMn
							  RunAdmin.exe /RunWait PROGRAM PARAM1 PARAMn
			reply:=ipc.Receive()

		Option 2: Start Task RunAhk then send Command via NamedPipe IPC
		
			ipc := RunAdminIPC()
			ipc.StartTask()	; Starts Task AhkRun which starts AhkRun.ahk elevated in Listen() mode.
			ipc.Send( "/Run," CommandCSV)
			
			-or-
			
			ipc := RunAdminIPC()
			ipc.StartTask()
			ipc.Send( "/RunWait," CommandCSV)
			reply:=ipc.Receive()
		
	Case 2. Shortcut (/Run no reply only. /RunWait with reply not supported):
	
		Shortcut Target: A_AhkPath RunAdmin.ahk /Run PROGRAM PARAM1 PARAMN
		Shortcut Target:                   RunAdmin.exe /Run PROGRAM PARAM1 PARAMN

		Shortcut Target Examples:
		%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe "%USERPROFILE%\Documents\AutoHotkey\Lib\RunAdmin.ahk" "/Run" "%ProgramFiles(x86)%\SyncBackSE\SyncBackSE.exe" "-monoff" "MY PROFILE"
		%USERPROFILE%\Documents\AutoHotkey\Lib\RunAdmin.exe /Run "D:\Software\DEV\Work\AHK2\Projects\~Tools\SearchBarReset\SearchBarReset.exe"


; Run if direct, Skip if included

RunAdmin.ahk
	if A_Args
		StartTask()
		CommandCSV:= ArrayToCSV(A_Args)
		pipe.Send(CommandCSV)
		pipe.Close()
	else
		pipe.Listen()
		CommandCSV:= pipe.Receive()
		if /Run
			runner.Run(CommandCSV)
		else if /RunWait
			reply:= runner.RunWait(CommandCSV)
			pipe.Send(reply)
		pipe.Close()

RunAdmin Task
---------------------
All OK:
	%USERPROFILE%\Documents\AutoHotkey\Lib\RunAdmin.ahk
	C:\ProgramData\AutoHotkey\RunAdmin\RunAdmin.ahk
	C:\Users\Jim\AppData\Local\Programs\AutoHotkey\RunAdmin\RunAdmin.ahk
	=> %LOCALAPPDATA%\Programs\AutoHotkey\RunAdmin\RunAdmin.ahk

D:\Software\DEV\Work\AHK2\Projects\~Lib\RunAdmin\RunAdmin.ahk
C:\Users\Jim\AppData\Local\Programs\AutoHotkey\RunAdmin\RunAdmin.ahk
 
TestLog shortcut
-------------------------------
%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe %LOCALAPPDATA%\Programs\AutoHotkey\RunAdmin\RunAdmin.ahk /Run "D:\TEST\TestLog.exe"

%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe %USERPROFILE%\Documents\AutoHotkey\Lib\RunAdmin.ahk /Run "D:\TEST\TestLog.exe"

%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe %USERPROFILE%\Documents\AutoHotkey\Lib\RunAdmin.ahk /Run "D:\TEST\TestLog.exe"
%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe "C:\ProgramData\AutoHotkey\RunAdmin\RunAdmin.ahk" /Run "D:\TEST\TestLog.exe"
C:\ProgramData\AutoHotkey\RunAdmin\RunAdmin.exe /Run D:\TEST\TestLog.exe
%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe D:\Software\DEV\Work\AHK2\Projects\~Lib\RunAdmin\RunAdmin.ahk /Run "D:\TEST\TestLog.exe"

SearchBarReset shortcut
----------------------------------
%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe %USERPROFILE%\Documents\AutoHotkey\Lib\RunAdmin.ahk /Run "D:\Software\DEV\Work\AHK2\Projects\~Tools\SearchBarReset\SearchBarReset.ahk"



%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe %USERPROFILE%\Documents\AutoHotkey\Lib\RunAdmin.ahk /Run D:\TEST\TestLogArgs.ahk MyParam
%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe D:\Software\DEV\Work\AHK2\Projects\~Lib\RunAdmin\RunAdmin.ahk /Run "D:\Software\DEV\Work\AHK2\Projects\~Tools\SearchBarReset\SearchBarReset.ahk"
%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe "%USERPROFILE%\Documents\AutoHotkey\Lib\TestLogArgs.ahk" "BACKUP" "PROFILE" "POST-ACTION"
%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe %USERPROFILE%\Documents\AutoHotkey\Lib\TestLogArgs.ahk BACKUP PROFILE POST-ACTION

TestLogArgs shortcut
------------------------------
%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe %USERPROFILE%\Documents\AutoHotkey\Lib\RunAdmin.ahk /Run D:\TEST\TestLogArgs.ahk MyParam

Works but Non-Admin: Note the shortcut removes the quotes from the target but not params: "%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe" 
%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe D:\TEST\TestLogArgs.ahk MyParams.ahk
"%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe" "D:\TEST\TestLogArgs.ahk" "MyParams.ahk"

SyncBack shortcut
------------------------------
%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe "D:\Software\DEV\Work\AHK2\Projects\~Lib\RunAdmin\RunAdmin.ahk"  --Run "C:\Program Files (x86)\SyncBackSE\SyncBackSE.exe" "-monoff" "TEST WITH SPACES"

%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe "%USERPROFILE%\Documents\AutoHotkey\Lib\RunAdmin.ahk" "/Run" "%ProgramFiles(x86)%\SyncBackSE\SyncBackSE.exe" "-monoff" "TEST WITH SPACES"

%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe D:\RunAdmin.ahk /Run "%ProgramFiles(x86)%\SyncBackSE\SyncBackSE.exe" "-monoff" "TEST WITH SPACES"

Test:


old:
%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe "D:\Software\DEV\Work\AHK2\Projects\~Lib\RunAdmin\RunAdmin.ahk"  "D:\TEST\TestLogArgs.ahk" "MyParams"
%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe D:\Software\DEV\Work\AHK2\Projects\~Lib\RunAdmin\RunAdmin.ahk D:\TEST\TestLogArgs.ahk MyParams

"C:\Users\Jim\Documents\AutoHotkey\Lib\RunAdmin.ahk"




%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe "D:\Software\DEV\Work\AHK2\Projects\~Lib\RunAdmin\RunAdmin.ahk"  "C:\Program Files (x86)\SyncBackSE\SyncBackSE.exe" "monoff" "TEST WITH SPACES"
%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe "D:\Software\DEV\Work\AHK2\Projects\~Lib\RunAdmin\RunAdmin.ahk"  "C:\Program Files (x86)\SyncBackSE\SyncBackSE.exe" "monoff" "TEST WITH SPACES"	

maybe? "%USERPROFILE%\Documents\AutoHotkey\Lib\RunAhk.exe "D:\Software\DEV\Work\AHK2\Projects\~Lib\RunAdmin\RunAdmin.ahk"  "C:\Program Files (x86)\SyncBackSE\SyncBackSE.exe" "monoff" "TEST WITH SPACES"

Use Cases:
	1. Controller Script Launches Worker Elevated, Controller Script sends Run (no Reply) or RunWait (Reply) to Worker.
	2. ShortCut Target="AdminRun CommandLine" Launches AdminRun Elevated, AdminRun sends Run (no Reply) "CommandLine"

	Use Case 1. Controller Script Launches Worker Elevated, Controller Script sends Run (no Reply) or RunWait (Reply) to Worker.
	Controller StartTask which runs RunAdmin.ahk Elevated in Listen mode.
	Controller sends Run(Worker) or RunWait(Worker) 
	Controller Receives reply from Worker
	Controller performs post-run actions
	
	Use Case 2. ShortCut Target="AdminRun CommandLine" Launches AdminRun Elevated, AdminRun sends Run (no Reply) "CommandLine"
	ShortCut Launches AdminRun.ahk
	AdminRun.ahk StartTask which runs RunAdmin.ahk Elevated in Listen mode.
	AdminRun.ahk sends Run(MyApp) (No Reply)
	
	All OK:
	
	Target="D:\TEST\TestLog.ahk"
	Target="C:\Program Files\AutoHotkey\v2\AutoHotkey64.exe" "D:\TEST\TestLog.ahk"
	Target="%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe" "D:\TEST\TestLog.ahk"
	Target="%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe" "%USERPROFILE%\Documents\AutoHotkey\Lib\TestLog.ahk" 
	Target="%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe" "%USERPROFILE%\Documents\AutoHotkey\Lib\TestLogArgs.ahk" BACKUP PROFILE POST-ACTION
	Target="%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe" "%USERPROFILE%\Documents\AutoHotkey\Lib\TestLogArgs.ahk" "BACKUP" "PROFILE" "POST-ACTION" ; no quotes logged
	
	%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe "D:\Software\DEV\Work\AHK2\Projects\~Lib\RunAdmin\RunAdmin.ahk"  "C:\Program Files (x86)\SyncBackSE\SyncBackSE.exe" "monoff" "TEST WITH SPACES"
	
	D:\Software\DEV\Work\AHK2\Projects\~Lib\RunAdmin\RunAdmin.exe "C:\Program Files (x86)\SyncBackSE\SyncBackSE.exe" "monoff" "TEST WITH SPACES"
	D:\Software\DEV\Work\AHK2\Projects\~Lib\RunAdmin\RunAdmin.exe "%USERPROFILE%\Documents\AutoHotkey\Lib\TestLogArgs.ahk" "BACKUP" "PROFILE" "POST-ACTION"
	
	
	NO: Requires %PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe" 
	Target="D:\TEST\TestLogArgs.ahk one two three

	Target="C:\Program Files\AutoHotkey\v2\AutoHotkey64.exe" "C:\Users\Jim\Documents\AutoHotkey\Lib\AdminRun.ahk"  "MyApp" "MyParams"
	Target="%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe" "%USERPROFILE%\Documents\AutoHotkey\Lib\AdminRun.ahk"  "MyApp" "MyParams"
	Target="%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe" "D:\Software\DEV\Work\AHK2\Projects\~Lib\AdminRun\RunAdmin.ahk"  "%USERPROFILE%\Documents\AutoHotkey\Lib\TestLogArgs.ahk" "MyParams"
	Target="D:\Software\DEV\Work\AHK2\Projects\~Lib\RunAdmin\RunAdmin.ahk"  "%USERPROFILE%\Documents\AutoHotkey\Lib\TestLogArgs.ahk" "MyParams"
	Target="%PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe" "D:\Software\DEV\Work\AHK2\Projects\~Lib\RunAdmin\RunAdmin.ahk"  "%USERPROFILE%\Documents\AutoHotkey\Lib\TestLogArgs.ahk" "MyParams"
	             %PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe "D:\Software\DEV\Work\AHK2\Projects\~Lib\RunAdmin\RunAdmin.ahk"  "%USERPROFILE%\Documents\AutoHotkey\Lib\TestLogArgs.ahk" "MyParams"
	            %PROGRAMFILES%\AutoHotkey\v2\AutoHotkey64.exe "D:\Software\DEV\Work\AHK2\Projects\~Lib\RunAdmin\RunAdmin.ahk"  "%USERPROFILE%\Documents\AutoHotkey\Lib\TestLogArgs.ahk" "MyParams"
	


	
	commandCSV:= "/Run, MyApp, Params"
	commandCSV:= "/RunWait, MyApp, Params"
	
	Task AdminLauncher runs AdminLauncher.ahk Worker Params


Use Cases:
	ABANDON 1 & 2, ONLY 3 IS NEEDED!
	1. Controller Launches Worker Elevated, Run no Reply
	2. Controller Launches Worker Elevated, RunWait for Reply
	3. Controller Run AdminLauncher [/wait] Worker Params

1. Controller Launches Worker Elevated, RunWait for Reply
	Controller StartTask AdminLauncher, launches AdminLauncher.ahk
	AdminLauncher.Listen()
	Controller commandCSV:=RunShell(ArrayToCSV(Worker.[exe, ahk], Params))
	Controller RunWait(commandCSV) to AdminLauncher
	AdminLauncher.RunWait(commandCSV)
	AdminLauncher.Send(reply)
	Controller Receive()
	Controller performs post-run actions

2. Controller Launches Worker Elevated, Run no Reply
	Controller StartTask AdminLauncher, launches AdminLauncher.ahk
	AdminLauncher.Listen()
	Controller commandCSV:=RunShell(ArrayToCSV(Worker.[exe, ahk], Params))
	Controller Run(commandCSV) to AdminLauncher 
	AdminLauncher.Run(commandCSV)

3. Controller Run AdminLauncher [/wait] Worker Params
	AdminLauncher
		commandCSV:=RunShell(ArrayToCSV(A_Args))
		StartTask AdminLauncher, launches AdminLauncher.ahk
		AdminLauncher.Listen()
		if /wait
			AdminLauncher.RunWait(commandCSV)
			AdminLauncher.Send(reply)
			Output:=AdminLauncher.Receive()
			FileAppend Output, StdOut
		else
			AdminLauncher.Run(commandCSV)
			FileAppend Output, t/f/errorCode?

			
Controller
launcher := AdminRun
launcher.Run(commandCSV)
launcher.RunWait(commandCSV)
	


ABANDON
	Control and Worker both in the same Script (Avoids separate Control and Worker Scripts)
	Program.exe Start Task to Run Program.exe /worker and Params, Receive Reply from Program.exe / worker
	Example: Program.exe starts Task to run Program.exe /worker who runs a Backup Tool, then performs post-action (e.g. shutdown)

Control
	launcher := AdminLauncher()
	launcher.StartTask()
	launcher.Send(Control.ahk, /worker, Program.exe, Param1, ParamN )
	reply := launcher.Receive()

Task AdminLauncher runs AdminLauncher.ahk

AdminLauncher.ahk
	launcher:=AdminLauncher(this?)
	requestCSV:=this.Listen()
	RunShell(requestCSV)
	launcher.Send(ACK)
	
Control
	if A_Args
		RunAsWorker()
	Gui
	Submit
	
	RunAsWorker()
		launcher := AdminLauncher()
		commandCSV := RunShell.ArrayToCSV(A_Args)
		RunShell(commandCSV)
		PostActionl(commandCSV)


	
	
	
SIGNIFICANTLY SIMPLIFIED WITH INI FILE
ACK?
	SendMessage true/false?

Control.exe
	launcher := AdminLauncher()
	launcher.Wait()
	launcher.Receive()
	



	ini:=IniFile(A_Temp \ AdminLauncher.ini)
	ini.WriteSettings("COMMAND_CSV", "C:\Program Files\SyncBack.exe, Profile, Post-Action")
	launcher := AdminLauncher() ; auto StartTask() launcher.StartTask()
	
	launcher := AdminLauncher() 
	launcher.CommandArray:="C:\Program Files\SyncBack.exe, Profile, Post-Action"
	launcher.CommandCSV:="C:\Program Files\SyncBack.exe, Profile, Post-Action"
	launcher.CommandString:='"C:\Program Files\SyncBack.exe" Profile, Post-Action"'
	launcher.Start()
	launcher.Run(CommandCSV)
	
Task AdminLauncher starts AdminLauncher.ahk at runLevel='highest'

AdminLauncher.ahk
	commandCSV := ini.ReadSettings("COMMAND_CSV")
	RunShell(commandCSV)
	
A_Temp \AdminLauncher.ini
	[Settings]
	WINDOW_TITLE=BackupTool.ahk
	COMMAND_CSV=BackupTool.ahk /worker, SyncBack.exe, Profile, Post-Action
	RESULT=Blank=running, value (t/f/errorCode)
	
	AdminLauncher.ini
	+R=busy
	-R=ready
	
	
if run directly
	RunAdmin /Listen (default if no args)
	RunAdmin /Run Program Params

RunAdmin
	if !Args
		if !Listener
			RunShell RunAdmin /Listen
		else
		commandCSV:=Listen()
		RunShell(commandCSV)
		ExitApp	
	else if /Listen
		run A_AhkPath RunAdmin /Listen
	else
		commandCSV:=RunShell.ArrayToCSV(A_Args)
		RunShell(CommandCSV)
	ExitApp()


Control
	runner:= RunAdmin()
	runner.StartTask() - RunAdmin starts elevated and goes into Listen() mode
	runner.Run(commandCSV)
	runner.RunWait(commandCSV)
		
		-or-
		
		RunShell(RunAdmin, MyApp, MyParams)
		
Control
	RunAdmin !IsAdmin
	StartTask() - RunAdmin IsAdmin and in Listen() mode
	commandCSV := RunShell.ToCSV(Program, Params)
	runner.RunWait(commandCSV)
	reply:= runner.Receive()
	Control perform post-run actions
	
ShortCut [A_AhkPath RunAdmin] [ RunAdmin.exe] Program Params
	RunAdmin !IsAdmin
	StartTask() - RunAdmin IsAdmin and in Listen() mode
	Run(Program, Params)
	
Task runLevel='highest' RunAdmin
	Task RunAdmin is started - RunAdmin.ahk IsAdmin and in Listen() mode

RunAdmin
	
	if IsAdmin
	
		if Args	
			commandCSV:=RunShell.ArrayToCSV(A_Args)
			Run(Args)
			
		else
		
			Listen
			
	else
	
		if Args	
			commandCSV:=RunShell.ArrayToCSV(A_Args)
			StartTask() and Listen()
			runner.Run(commandCSV)	
	


	if !IsAdmin and !Args {
			StartTask() and Listen()		
	}
	
	if !IsAdmin and Args {
		commandCSV:=RunShell.ArrayToCSV(A_Args)
		StartTask() and Listen()
		runner.Run(commandCSV)	
	}
	
	if IsAdmin and !Args {
		do nothing		
	}
	
	if IsAdmin and Args {
		commandCSV:=RunShell.ArrayToCSV(A_Args)
		runner.Run(commandCSV)	
	}
	


Run, Script.exe, /help
RunWait, Script.exe, /help

ipc := RunAdminIPC()
ipc.Send(CommandCSV)
reply:=Ipc.Receive()
